이미지 좌표계(x, y)를 로봇 XYZ 좌표계로 변환하는 전략
1) 좌표계 정의

이미지 좌표계 (u, v): 카메라 픽셀 좌표(좌상단 원점, u는 오른쪽+, v는 아래+)

카메라 좌표계 (Xc, Yc, Zc): 카메라 광학 중심 기준 3D

로봇 베이스 좌표계 (Xb, Yb, Zb): 로봇의 작업 좌표(보통 Z가 위쪽+)

최종 목표: 이미지에서 검출된 콜로니 중심/밀집점 픽셀 (u, v) → 로봇이 이동해야 할 (Xb, Yb, Zb)

2) 카메라 보정(필수)

카메라 내부 파라미터(K) + 왜곡계수를 체커보드 등으로 캘리브레이션
→ 왜곡이 있으면 픽셀→좌표 변환이 틀어져서 위치 오차가 커짐

실시간/오프라인 모두에서 입력 픽셀 (u, v)에 대해 undistort 적용

3) “Z 정보를 어떻게 얻는가”가 핵심 (2가지 전략)
A. 플레이트가 평면이라고 가정(가장 현실적/간단)

콜로니는 플레이트 상단의 거의 동일한 높이(평면)에 있음
→ 즉 Z는 상수(플레이트 표면 높이) 로 둔다.

이 경우 픽셀 ↔ 평면 간 변환은 2D homography(H) 로 해결 가능

절차

플레이트 위에서 로봇이 접근 가능한 기준점(코너/마커/웰 중심 등) 최소 4개를 선택

각 점에 대해

이미지 픽셀 좌표: (u, v)

로봇 베이스 좌표의 평면상 좌표: (Xb, Yb) (Zb는 고정)

이 대응으로 Homography H 추정 (이미지→베이스 평면)

새로 검출한 콜로니 픽셀 (u, v)에 대해

𝑋
𝑏
,
𝑌
𝑏
,
1
Xb,Yb,1^T ∝ H · 
𝑢
,
𝑣
,
1
u,v,1^T

Zb는 “작업 높이”로 고정(예: 안전 접근 높이 → 작업 높이)

장점

깊이 센서 없이도 가능

구현/검증이 쉽고 채용 과제에서 설득력이 높음
주의

카메라/플레이트가 움직이면 H 재보정 필요

B. 3D로 풀기(카메라–로봇 외부 보정 포함)

카메라가 로봇 외부에 고정되어 있고 3D 좌표가 필요하면,

픽셀 (u, v) → 카메라 광선(ray)로 변환 후

작업 평면과의 교차점 또는 깊이(Zc)로 3D 점을 만든 다음

카메라→로봇 변환을 적용한다.

절차

픽셀을 카메라 광선으로 변환

정규화 좌표: 
𝑥
,
𝑦
,
1
x,y,1^T = K^{-1} · 
𝑢
,
𝑣
,
1
u,v,1^T

Zc를 얻는 방법

(추천) 플레이트 평면 방정식과 ray의 교차로 Zc 결정

또는 깊이카메라/스테레오로 Zc 획득

카메라 좌표의 점 Pc를 로봇 좌표로 변환

Pb = T_bc · Pc

T_bc는 hand–eye calibration 또는 로봇으로 기준점 여러 개 찍어서 추정

장점

카메라 위치/자세 변화에도 강함(정확한 외부보정 전제)
단점

보정 난이도와 구현 복잡도가 증가

4) 실무적인 운용(로봇 동작 관점)

로봇 이동은 보통 2단계로 설계:

Approach pose: (Xb, Yb, Zsafe)로 안전 접근

Work pose: (Xb, Yb, Zwork)로 내려가 작업(픽킹/마킹/흡입 등)

오차/안전 처리:

플레이트 가장자리, 웰 경계 등 금지 영역 마스크

픽셀 검출이 불확실한 경우(면적 너무 작음/블러) → 스킵 또는 재촬영

결론(한 줄 요약)

본 과제 상황(플레이트/카메라 고정, 콜로니가 평면 위)에서는 Homography 기반 2D(픽셀→로봇 XY) + Z 고정/2단계 접근이 가장 간단하고 안정적이며, 필요 시 카메라–로봇 외부 보정(T_bc) + 광선-평면 교차로 3D 확장할 수 있다.
